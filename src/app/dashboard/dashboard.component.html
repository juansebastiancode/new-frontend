<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<div class="dashboard-container">
  <!-- Contenido principal sin menú -->
  <div class="main-content no-menu">
    <div class="hero">
      <div class="user-header">
        <div class="user-info" (click)="toggleUserDropdown()">
          <div class="user-avatar">
            <div class="avatar-circle">
              <img *ngIf="!imageError && (auth.getCurrentUser()?.photoURL)" [src]="auth.getCurrentUser()?.photoURL || ''" [alt]="userName" class="avatar-image" (error)="onImageError()">
              <div *ngIf="imageError || !(auth.getCurrentUser()?.photoURL)" class="avatar-text">{{ userInitial }}</div>
            </div>
          </div>
          <div class="user-details">
            <div class="user-name">{{ userName }}</div>
          </div>
          <div class="dropdown-arrow">
            <i class="fas fa-chevron-down" [class.rotated]="showUserDropdown"></i>
          </div>
        </div>
          <div class="user-dropdown" *ngIf="showUserDropdown" (click)="$event.stopPropagation()">
          <div class="dropdown-item" (click)="goToProfile()">
            <i class="fas fa-user"></i>
            <span>Mi Perfil</span>
          </div>
          <div class="dropdown-item" (click)="logout()">
            <i class="fas fa-right-from-bracket"></i>
            <span>Cerrar Sesión</span>
          </div>
        </div>
      </div>
      <h1>Plan B</h1>
      <div class="actions">
        <button class="primary" (click)="createProject()">Crear proyecto</button>
        <div class="search-wrap">
          <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="m21 21-4.35-4.35m0 0A7.5 7.5 0 1 0 5.65 5.65a7.5 7.5 0 0 0 10.6 10.6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input class="search" type="text" placeholder="Buscar..." [(ngModel)]="searchQuery" (input)="onSearchChange()" />
        </div>
      </div>
      <div class="helper" *ngIf="searchHint">{{ searchHint }}</div>
    </div>
    
    <!-- Modal crear proyecto -->
    <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeModal()"></div>
    <div class="modal-card" *ngIf="showCreateModal" (click)="$event.stopPropagation()">
      <h3>Crear proyecto</h3>
      <div class="form-row">
        <label>Nombre</label>
        <input type="text" [(ngModel)]="projectName" placeholder="Ej. Mi nuevo proyecto" />
      </div>
      <div class="form-row">
        <label>Sector</label>
        <input type="text" [(ngModel)]="projectSector" placeholder="Ej. Restauración" />
      </div>
      <div class="modal-actions">
        <button class="ghost" (click)="closeModal()">Cancelar</button>
        <button class="primary" [disabled]="!projectName" (click)="confirmCreate()">Crear</button>
      </div>
    </div>
    
    <div class="projects-wrap">
      <div class="projects-header">
        <span class="muted" *ngIf="loadingProjects">Cargando...</span>
        <span class="error" *ngIf="loadError">{{ loadError }}</span>
      </div>
      <div class="projects" *ngIf="projects?.length; else emptyState">
        <div class="project-card" *ngFor="let p of projects">
          <h4>{{ p.name }}</h4>
          <div class="meta">{{ p.sector || 'Sin sector' }} · {{ p.createdAt | date:'short' }}</div>
        </div>
      </div>
      <ng-template #emptyState>
        <div class="empty">No tienes proyectos todavía. Crea el primero.</div>
      </ng-template>
    </div>

    <app-profile *ngIf="showProfile" (closeProfile)="closeProfile()"></app-profile>
  </div>
</div>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  }

  .dashboard-container {
    width: 100%;
    height: 100vh;
    background: white;
    position: relative;
  }

  .main-content { height: 100vh; background: white; }
  .main-content.no-menu { margin-left: 0; }

  .hero {
    max-width: 960px;
    margin: 0 auto;
    padding: 48px 24px;
  }
  .user-header { position: absolute; top: 16px; right: 24px; }
  .user-info { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 6px 8px; border-radius: 8px; transition: background .2s; }
  .user-info:hover { background: rgba(0,0,0,0.04); }
  .user-avatar .avatar-circle { width: 28px; height: 28px; border-radius: 50%; overflow: hidden; background: #f0f0f0; }
  .avatar-image { width: 100%; height: 100%; object-fit: cover; }
  .avatar-text { color: #fff; background: #ff9500; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 12px; font-weight: 600; }
  .user-name { font-size: 12px; color: #333; }
  .dropdown-arrow { color: #666; font-size: 12px; }
  .dropdown-arrow i.rotated { transform: rotate(180deg); }
  .user-dropdown { position: absolute; right: 24px; top: 52px; background: #fff; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.12); overflow: hidden; min-width: 180px; border: 1px solid #e9e9e9; }
  .user-dropdown .dropdown-item { display: flex; align-items: center; gap: 8px; padding: 12px 14px; cursor: pointer; border-bottom: 1px solid #f3f3f3; }
  .user-dropdown .dropdown-item:last-child { border-bottom: none; }
  .user-dropdown .dropdown-item:hover { background: #f8f9fa; }
  .user-dropdown .dropdown-item i { color: #333; width: 14px; text-align: center; font-size: 12px; }
  .user-dropdown .dropdown-item span { font-size: 13px; }
  .hero h1 {
    font-size: 48px;
    letter-spacing: 1px;
    margin-bottom: 24px;
    color: #111;
  }
  .actions { display: flex; gap: 12px; align-items: center; }
  .primary {
    background: #111;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 12px 16px;
    cursor: pointer;
    white-space: nowrap; /* evita salto de línea */
  }
  .primary:hover { opacity: 0.9; }
  .search {
    flex: 1;
    min-width: 240px;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 12px 14px;
    outline: none;
  }
  .search-wrap { position: relative; display: flex; align-items: center; width: 100%; }
  .search-icon { position: absolute; left: 12px; pointer-events: none; color: #888; }
  .search-wrap .search { padding-left: 36px; }
  .helper { margin-top: 12px; color: #666; font-size: 14px; }

  /* Grid de proyectos */
  .projects {
    max-width: 960px;
    margin: 12px auto 0 auto;
    padding: 0 24px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 12px;
  }
  .project-card {
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 14px;
    background: #fff;
  }
  .project-card h4 { margin: 0 0 6px 0; font-size: 16px; }
  .project-card .meta { color: #777; font-size: 12px; }
  .projects-wrap { max-width: 960px; margin: 4px auto 0 auto; padding: 0 24px; }
  .projects-header { display: flex; align-items: center; gap: 12px; }
  .projects-header h3 { margin: 0; font-size: 18px; }
  .muted { color: #777; font-size: 13px; }
  .error { color: #c00; font-size: 13px; }
  .empty { color: #777; font-size: 14px; padding: 12px 0; }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
  }
  .modal-card {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 560px;
    max-width: calc(100% - 32px);
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .modal-card h3 { margin: 0 0 4px 0; }
  .form-row { display: flex; flex-direction: column; gap: 6px; }
  .form-row label { font-size: 13px; color: #666; }
  .form-row input {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px 12px;
    outline: none;
  }
  .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 8px; }
  .ghost {
    background: transparent;
    color: #333;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px 14px;
    cursor: pointer;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .main-content { margin-left: 0; }
  }
</style>